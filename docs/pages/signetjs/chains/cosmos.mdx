# Cosmos Chain Implementation

The Cosmos chain implementation supports Cosmos SDK-based networks (Cosmos Hub, Osmosis, etc.) with a focus on standard transactions and IBC transfers.

## Configuration

```ts twoslash filename="base.ts"
// [!include ~/snippets/code/contract.ts]
// ---cut---
import { Cosmos } from 'signet.js'

const chain = new Cosmos({
  chainId: 'cosmoshub-4', // Chain ID of the target network
  contract,
})
```

## Methods

### getBalance

Gets the native token balance of an address in the chain's base units.

```ts twoslash
// [!include base.ts]
// ---cut---
const { balance, decimals } = await chain.getBalance('cosmos1...')
```

**Parameters:**

- `address`: The Cosmos bech32 address to check

**Returns:**

- The balance in the chain's base units as a bigint
- The number of decimals used to format the balance

### deriveAddressAndPublicKey

Derives an Cosmos bech32 address and public key from a predecessor ID and derivation path.

```ts twoslash
// [!include base.ts]
// ---cut---
const { address, publicKey } = await chain.deriveAddressAndPublicKey(
  'cosmos1...',
  'any_string'
)
```

**Parameters:**

- `predecessor`: The wallet/contract address requesting the signature
- `path`: The derivation path to use

**Returns:**

- Object containing:
  - `address`: The derived Cosmos bech32 address
  - `publicKey`: The corresponding public key in SEC1 uncompressed format

### prepareTransactionForSigning

Prepares a transaction for MPC signing.

```ts twoslash filename="unsigned-transaction.ts"
// [!include base.ts]
// ---cut---
import { CosmosTransactionRequest } from 'signet.js'
import { MsgSend } from 'cosmjs-types/cosmos/bank/v1beta1/tx'

// Create a token transfer message
const transactionRequest: CosmosTransactionRequest = {
  address: 'cosmos1...',
  publicKey: '0350e8...',
  messages: [
    {
      typeUrl: '/cosmos.bank.v1beta1.MsgSend',
      value: {
        fromAddress: 'cosmos1...',
        toAddress: 'cosmos1...',
        amount: [
          {
            denom: 'uatom',
            amount: '1000000',
          },
        ],
      },
    },
  ],
  memo: 'Token transfer',
}

const { transaction: unsignedTransaction, hashesToSign } =
  await chain.prepareTransactionForSigning(transactionRequest)
```

### attachTransactionSignature

Adds signatures to a transaction.

```ts twoslash filename="add-signature.ts"
// [!include unsigned-transaction.ts]
// ---cut---
import { RSVSignature } from 'signet.js'

// Ideally it would be a request to the Sig Network Smart Contract
const rsvSignatures: RSVSignature[] = [
  {
    r: '0x...',
    s: '0x...',
    v: 27,
  },
]

const signedTx = chain.attachTransactionSignature({
  transaction: unsignedTransaction,
  rsvSignatures,
})
```

**Parameters:**

- `transaction`: The unsigned transaction
- `rsvSignatures`: Array of RSV signatures from MPC

**Returns:**

- The serialized signed transaction in hex format

### broadcastTx

Broadcasts a signed transaction to the network.

```ts twoslash
// [!include base.ts]
// ---cut---
const txHash = await chain.broadcastTx('0x...transactionSerialized')
```

**Parameters:**

- `txSerialized`: The serialized signed transaction

**Returns:**

- The transaction hash

## Types

The following types are used on the Cosmos chain:

```ts twoslash
// [!include ~/../src/chains/Cosmos/types.ts]
```

## Technical Details

The implementation:

- Uses `@cosmjs/stargate` for transaction handling
- Supports SIGN_MODE_DIRECT signing
- Uses Protobuf for message encoding
- Supports standard Cosmos SDK messages:
  - Bank (Send, MultiSend)
  - Staking (Delegate, Undelegate, Redelegate)
  - Distribution (Withdraw Rewards)
  - IBC (Transfer)
- Handles automatic fee calculation based on gas prices
- Supports custom message types through the Registry
